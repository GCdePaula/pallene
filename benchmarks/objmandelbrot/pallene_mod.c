/* This file was generated by the Pallene compiler. Do not edit by hand" */
/* Indentation and formatting courtesy of pallene/C.lua */

#include "pallene_core.h"

/* ------- */
/* Records */
/* ------- */

/* ------------------- */
/* Function Prototypes */
/* ------------------- */

static void function_01(
    lua_State *L,
    Udata *G,
    StackValue *base
);
static Table * function_02(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Number x1, /* x */
    lua_Number x2  /* y */
);
static Table * function_03(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* x */
);
static Table * function_04(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* x */
);
static Table * function_05(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* x */
    Table *x2  /* y */
);
static Table * function_06(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* x */
    Table *x2  /* y */
);
static lua_Number function_07(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* x */
);

/* ------------------------ */
/* Function Implementations */
/* ------------------------ */

/* $init */
static void function_01(
    lua_State *L,
    Udata *G,
    StackValue *base
) {
    	
}

/* new benchmarks/objmandelbrot/pallene.pln:1 */
static Table * function_02(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Number x1, /* x */
    lua_Number x2  /* y */
) {
    luaD_checkstack(L, 1);
    Table *x3;
    	
    x3 = pallene_createtable(L, 2, 0);
    sethvalue(L, s2v(base + 0), x3);
    luaC_condGC(L, L->top = base + 1, (void)0);
    //create table
    {
        //pallene_renormalize_array(L, x3, 1, 2);
        TValue *slot = &x3->array[1 - 1];
        setfltvalue(slot, x1);
    }
    {
        //pallene_renormalize_array(L, x3, 2, 2);
        TValue *slot = &x3->array[2 - 1];
        setfltvalue(slot, x2);
    }
    return x3;
}

/* clone benchmarks/objmandelbrot/pallene.pln:5 */
static Table * function_03(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* x */
) {
    Table *x2;
    lua_Number x3;
    lua_Number x4;
    //unify
    pallene_renormalize_array(L, x1, 2, 6);	
    {
        //pallene_renormalize_array(L, x1, 1, 6);
        TValue *slot = &x1->array[1 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                6, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x3 = fltvalue(slot);
    }
    {
        
        TValue *slot = &x1->array[2 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                6, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x4 = fltvalue(slot);
    }
    {
        StackValue *old_stack = L->stack;
        x2 = function_02(L, G, base + 0, x3, x4);
        base = L->stack + (base - old_stack);
    }
    return x2;
}

/* conj benchmarks/objmandelbrot/pallene.pln:9 */
static Table * function_04(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* x */
) {
    Table *x2;
    lua_Number x3;
    lua_Number x4;
    lua_Number x5;
    // unify
    pallene_renormalize_array(L, x1, 2, 10);	
    {
        //pallene_renormalize_array(L, x1, 1, 10);
        TValue *slot = &x1->array[1 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                10, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x3 = fltvalue(slot);
    }
    {
        
        TValue *slot = &x1->array[2 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                10, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x5 = fltvalue(slot);
    }
    x4 = -x5;
    {
        StackValue *old_stack = L->stack;
        x2 = function_02(L, G, base + 0, x3, x4);
        base = L->stack + (base - old_stack);
    }
    return x2;
}

/* add benchmarks/objmandelbrot/pallene.pln:13 */
static Table * function_05(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* x */
    Table *x2  /* y */
) {
    Table *x3;
    lua_Number x4;
    lua_Number x5;
    lua_Number x6;
    lua_Number x7;
    lua_Number x8;
    lua_Number x9;
    //unify
    pallene_renormalize_array(L, x1, 2, 14);
    //unify
    pallene_renormalize_array(L, x2, 2, 14);	
    {
        //pallene_renormalize_array(L, x1, 1, 14);
        TValue *slot = &x1->array[1 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                14, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x5 = fltvalue(slot);
    }
    {
        //pallene_renormalize_array(L, x2, 1, 14);
        TValue *slot = &x2->array[1 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                14, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x6 = fltvalue(slot);
    }
    x4 = x5 + x6;
    {
        //pallene_renormalize_array(L, x1, 2, 14);
        TValue *slot = &x1->array[2 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                14, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x8 = fltvalue(slot);
    }
    {
        //pallene_renormalize_array(L, x2, 2, 14);
        TValue *slot = &x2->array[2 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                14, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x9 = fltvalue(slot);
    }
    x7 = x8 + x9;
    {
        StackValue *old_stack = L->stack;
        x3 = function_02(L, G, base + 0, x4, x7);
        base = L->stack + (base - old_stack);
    }
    return x3;
}

/* mul benchmarks/objmandelbrot/pallene.pln:17 */
static Table * function_06(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* x */
    Table *x2  /* y */
) {
    Table *x3;
    lua_Number x4;
    lua_Number x5;
    lua_Number x6;
    lua_Number x7;
    lua_Number x8;
    lua_Number x9;
    lua_Number x10;
    lua_Number x11;
    lua_Number x12;
    lua_Number x13;
    lua_Number x14;
    lua_Number x15;
    lua_Number x16;
    lua_Number x17;
    //unify 
    pallene_renormalize_array(L, x1, 1, 18);
    //unify
    pallene_renormalize_array(L, x2, 1, 18);	
    {
        //pallene_renormalize_array(L, x1, 1, 18);
        TValue *slot = &x1->array[1 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                18, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x6 = fltvalue(slot);
    }
    {
        //pallene_renormalize_array(L, x2, 1, 18);
        TValue *slot = &x2->array[1 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                18, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x7 = fltvalue(slot);
    }
    x5 = x6 * x7;
    {
        //pallene_renormalize_array(L, x1, 2, 18);
        TValue *slot = &x1->array[2 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                18, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x9 = fltvalue(slot);
    }
    {
        //pallene_renormalize_array(L, x2, 2, 18);
        TValue *slot = &x2->array[2 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                18, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x10 = fltvalue(slot);
    }
    x8 = x9 * x10;
    x4 = x5 - x8;
    {
        // //pallene_renormalize_array(L, x1, 1, 18);
        // TValue *slot = &x1->array[1 - 1];
        // if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
        //     pallene_runtime_tag_check_error(L,
        //         18, LUA_TNUMFLT, rawtt(slot),
        //         "array element");
        // }
        x13 = x6;//fltvalue(slot);
    }
    {
        // //pallene_renormalize_array(L, x2, 2, 18);
        // TValue *slot = &x2->array[2 - 1];
        // if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
        //     pallene_runtime_tag_check_error(L,
        //         18, LUA_TNUMFLT, rawtt(slot),
        //         "array element");
        // }
        x14 = x10;//fltvalue(slot);
    }
    x12 = x13 * x14;
    {
        // //pallene_renormalize_array(L, x1, 2, 18);
        // TValue *slot = &x1->array[2 - 1];
        // if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
        //     pallene_runtime_tag_check_error(L,
        //         18, LUA_TNUMFLT, rawtt(slot),
        //         "array element");
        // }
        x16 = x9;//fltvalue(slot);
    }
    {
        // //pallene_renormalize_array(L, x2, 1, 18);
        // TValue *slot = &x2->array[1 - 1];
        // if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
        //     pallene_runtime_tag_check_error(L,
        //         18, LUA_TNUMFLT, rawtt(slot),
        //         "array element");
        // }
        x17 = x7;//fltvalue(slot);
    }
    x15 = x16 * x17;
    x11 = x12 + x15;
    {
        StackValue *old_stack = L->stack;
        x3 = function_02(L, G, base + 0, x4, x11);
        base = L->stack + (base - old_stack);
    }
    return x3;
}

/* norm2 benchmarks/objmandelbrot/pallene.pln:21 */
static lua_Number function_07(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* x */
) {
    luaD_checkstack(L, 1);
    Table *x2; /* n */
    Table *x3;
    lua_Number x4;
    	
    {
        StackValue *old_stack = L->stack;
        x3 = function_04(L, G, base + 0, x1);
        base = L->stack + (base - old_stack);
    }
    sethvalue(L, s2v(base + 0), x3);
    {
        StackValue *old_stack = L->stack;
        x2 = function_06(L, G, base + 1, x1, x3);
        base = L->stack + (base - old_stack);
    }
    {
        pallene_renormalize_array(L, x2, 1, 23);
        TValue *slot = &x2->array[1 - 1];
        if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
            pallene_runtime_tag_check_error(L,
                23, LUA_TNUMFLT, rawtt(slot),
                "array element");
        }
        x4 = fltvalue(slot);
    }
    return x4;
}

/* ------- */
/* Exports */
/* ------- */

static int function_01_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 0)) {
        pallene_runtime_arity_error(L, "$init", 0, nargs);
    }
    	
    function_01(L, G, L->top);
    return 0;
}

static int function_02_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 2)) {
        pallene_runtime_arity_error(L, "new", 2, nargs);
    }
    	
    lua_Number x1;
    lua_Number x2;
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            1, LUA_TNUMFLT, rawtt(s2v(base + 1)),
            "argument '%s'", "x");
    }
    x1 = fltvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            1, LUA_TNUMFLT, rawtt(s2v(base + 2)),
            "argument '%s'", "y");
    }
    x2 = fltvalue(s2v(base + 2));
    	
    Table *ret1;
    ret1 = function_02(L, G, L->top, x1, x2);
    sethvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

static int function_03_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 1)) {
        pallene_runtime_arity_error(L, "clone", 1, nargs);
    }
    	
    Table *x1;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            5, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "x");
    }
    x1 = hvalue(s2v(base + 1));
    	
    Table *ret1;
    ret1 = function_03(L, G, L->top, x1);
    sethvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

static int function_04_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 1)) {
        pallene_runtime_arity_error(L, "conj", 1, nargs);
    }
    	
    Table *x1;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            9, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "x");
    }
    x1 = hvalue(s2v(base + 1));
    	
    Table *ret1;
    ret1 = function_04(L, G, L->top, x1);
    sethvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

static int function_05_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 2)) {
        pallene_runtime_arity_error(L, "add", 2, nargs);
    }
    	
    Table *x1;
    Table *x2;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            13, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "x");
    }
    x1 = hvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            13, LUA_TTABLE, rawtt(s2v(base + 2)),
            "argument '%s'", "y");
    }
    x2 = hvalue(s2v(base + 2));
    	
    Table *ret1;
    ret1 = function_05(L, G, L->top, x1, x2);
    sethvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

static int function_06_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 2)) {
        pallene_runtime_arity_error(L, "mul", 2, nargs);
    }
    	
    Table *x1;
    Table *x2;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            17, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "x");
    }
    x1 = hvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            17, LUA_TTABLE, rawtt(s2v(base + 2)),
            "argument '%s'", "y");
    }
    x2 = hvalue(s2v(base + 2));
    	
    Table *ret1;
    ret1 = function_06(L, G, L->top, x1, x2);
    sethvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

static int function_07_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 1)) {
        pallene_runtime_arity_error(L, "norm2", 1, nargs);
    }
    	
    Table *x1;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            21, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "x");
    }
    x1 = hvalue(s2v(base + 1));
    	
    lua_Number ret1;
    ret1 = function_07(L, G, L->top, x1);
    setfltvalue(s2v(L->top), ret1);
    L->top++;
    return 1;
}

int luaopen_benchmarks_objmandelbrot_pallene_mod(lua_State *L)
{
    luaL_checkversion(L);
    	
    lua_newuserdatauv(L, 0, 0);
    int globals = lua_gettop(L);
    	
    lua_createtable(L, 7, 0);
    int closures = lua_gettop(L);
    	
    lua_newtable(L);
    int export_table = lua_gettop(L);
    	
    /* Closures */
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_01_lua, 1);
    lua_seti(L, closures, 1);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_02_lua, 1);
    lua_seti(L, closures, 2);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_03_lua, 1);
    lua_seti(L, closures, 3);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_04_lua, 1);
    lua_seti(L, closures, 4);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_05_lua, 1);
    lua_seti(L, closures, 5);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_06_lua, 1);
    lua_seti(L, closures, 6);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_07_lua, 1);
    lua_seti(L, closures, 7);
    	
    /* Global values */
    	
    // Run toplevel statements & initialize globals
    lua_geti(L, closures, 1);
    lua_call(L, 0, 0);
    	
    /* Exports */
    	
    lua_pushstring(L, "new");
    lua_geti(L, closures, 2);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "clone");
    lua_geti(L, closures, 3);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "conj");
    lua_geti(L, closures, 4);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "add");
    lua_geti(L, closures, 5);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "mul");
    lua_geti(L, closures, 6);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "norm2");
    lua_geti(L, closures, 7);
    lua_settable(L, export_table);
    	
    lua_pushvalue(L, export_table);
    return 1;
}

