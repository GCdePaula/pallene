/* This file was generated by the Pallene compiler. Do not edit by hand" */
/* Indentation and formatting courtesy of pallene/C.lua */

#include "pallene_core.h"

/* ------- */
/* Records */
/* ------- */

/* ------------------- */
/* Function Prototypes */
/* ------------------- */

static void function_01(
    lua_State *L,
    Udata *G,
    StackValue *base
);
static lua_Number function_02(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Number x1  /* max */
);
static void function_03(
    lua_State *L,
    Udata *G,
    StackValue *base,
    TString *x1, /* id */
    TString *x2  /* desc */
);
static void function_04(
    lua_State *L,
    Udata *G,
    StackValue *base,
    TString *x1, /* id */
    TString *x2, /* desc */
    TString *x3, /* alu */
    lua_Integer x4  /* n */
);
static lua_Integer function_05(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* ps */
    lua_Number x2  /* p */
);
static void function_06(
    lua_State *L,
    Udata *G,
    StackValue *base,
    TString *x1, /* id */
    TString *x2, /* desc */
    Table *x3, /* frequencies */
    lua_Integer x4  /* n */
);

/* ------------------------ */
/* Function Implementations */
/* ------------------------ */

/* $init */
static void function_01(
    lua_State *L,
    Udata *G,
    StackValue *base
) {
    ptrdiff_t base_offset = savestack(L, base);
    	
    setivalue(&G->uv[5].uv, 42);
}

/* random benchmarks/fasta//pallene.pln:6 */
static lua_Number function_02(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Number x1  /* max */
) {
    ptrdiff_t base_offset = savestack(L, base);
    	
    lua_Integer x2;
    lua_Integer x3;
    lua_Integer x4;
    lua_Integer x5;
    lua_Integer x6;
    lua_Integer x7;
    lua_Integer x8;
    lua_Number x9;
    lua_Number x10;
    lua_Number x11;
    lua_Integer x12;
    lua_Number x13;
    lua_Integer x14;
    	
    x5 = ivalue(&G->uv[5].uv);
    x6 = 3877;
    x4 = intop(*, x5, x6);
    x7 = 29573;
    x3 = intop(+, x4, x7);
    x8 = 139968;
    x2 = pallene_int_modi(L, x3, x8, 7);
    setivalue(&G->uv[5].uv, x2);
    x12 = ivalue(&G->uv[5].uv);
    x11 = (lua_Number) x12;
    x10 = x1 * x11;
    x14 = 139968;
    x13 = (lua_Number) x14;
    x9 = x10 / x13;
    return x9;
}

/* print_fasta_header benchmarks/fasta//pallene.pln:13 */
static void function_03(
    lua_State *L,
    Udata *G,
    StackValue *base,
    TString *x1, /* id */
    TString *x2  /* desc */
) {
    luaD_checkstack(L, 1);
    ptrdiff_t base_offset = savestack(L, base);
    	
    TString *x3;
    	
    {
        TString *ss[5];
        ss[0] = tsvalue(&G->uv[0].uv);
        ss[1] = x1;
        ss[2] = tsvalue(&G->uv[1].uv);
        ss[3] = x2;
        ss[4] = tsvalue(&G->uv[2].uv); ;
        x3 = pallene_string_concatN(L, 5, ss);
    }
    setsvalue(L, s2v(base + 0), x3);
    luaC_condGC(L, L->top = base + 1, (void)0);
    pallene_io_write(L, x3);
}

/* repeat_fasta benchmarks/fasta//pallene.pln:17 */
static void function_04(
    lua_State *L,
    Udata *G,
    StackValue *base,
    TString *x1, /* id */
    TString *x2, /* desc */
    TString *x3, /* alu */
    lua_Integer x4  /* n */
) {
    luaD_checkstack(L, 2);
    ptrdiff_t base_offset = savestack(L, base);
    	
    lua_Integer x5; /* alusize */
    TString *x6; /* aluwrap */
    int x7;
    lua_Integer x8;
    lua_Integer x9;
    lua_Integer x10;
    lua_Integer x11; /* lines */
    lua_Integer x12;
    lua_Integer x13; /* last_line */
    lua_Integer x14;
    lua_Integer x15; /* start */
    lua_Integer x16; /* _ */
    lua_Integer x17; /* stop */
    lua_Integer x18;
    TString *x19;
    lua_Integer x20;
    int x21;
    TString *x22;
    lua_Integer x23;
    lua_Integer x24;
    	
    function_03(L, G, base + 0, x1, x2);
    base = restorestack(L, base_offset);
    x5 = tsslen(x3);
    {
        TString *ss[2];
        ss[0] = x3;
        ss[1] = x3; ;
        x6 = pallene_string_concatN(L, 2, ss);
    }
    setsvalue(L, s2v(base + 0), x6);
    luaC_condGC(L, L->top = base + 1, (void)0);
    while (1) {
        x8 = tsslen(x6);
        x10 = 60;
        x9 = intop(+, x5, x10);
        x7 = (x8 < x9);
        if (!x7) {
            break;
        }
        {
            TString *ss[2];
            ss[0] = x6;
            ss[1] = x3; ;
            x6 = pallene_string_concatN(L, 2, ss);
        }
        setsvalue(L, s2v(base + 0), x6);
        luaC_condGC(L, L->top = base + 1, (void)0);
    }
    x12 = 60;
    x11 = pallene_int_divi(L, x4, x12, 27);
    x14 = 60;
    x13 = pallene_int_modi(L, x4, x14, 28);
    x15 = 0;
    PALLENE_INT_FOR_LOOP_BEGIN(x16, 1, x11, 1)
    {
        x18 = 60;
        x17 = intop(+, x15, x18);
        x20 = intop(+, x15, 1);
        x19 = pallene_string_sub(L, x6, x20, x17);
        setsvalue(L, s2v(base + 1), x19);
        luaC_condGC(L, L->top = base + 2, (void)0);
        pallene_io_write(L, x19);
        pallene_io_write(L, tsvalue(&G->uv[2].uv));
        x15 = pallene_int_modi(L, x17, x5, 34);
    }
    PALLENE_INT_FOR_LOOP_END
    x21 = (x13 > 0);
    if (x21) {
        x23 = intop(+, x15, 1);
        x24 = intop(+, x15, x13);
        x22 = pallene_string_sub(L, x6, x23, x24);
        setsvalue(L, s2v(base + 0), x22);
        luaC_condGC(L, L->top = base + 1, (void)0);
        pallene_io_write(L, x22);
        pallene_io_write(L, tsvalue(&G->uv[2].uv));
    }
}

/* linear_search benchmarks/fasta//pallene.pln:42 */
static lua_Integer function_05(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* ps */
    lua_Number x2  /* p */
) {
    ptrdiff_t base_offset = savestack(L, base);
    	
    lua_Integer x3;
    lua_Integer x4; /* i */
    int x5;
    lua_Number x6;
    	
    if (x1->metatable) {
        pallene_runtime_array_metatable_error(L, 43);
    }
    x3 = luaH_getn(x1);
    PALLENE_INT_FOR_LOOP_BEGIN(x4, 1, x3, 1)
    {
        {
            pallene_renormalize_array(L, x1, x4, 44);
            TValue *slot = &x1->array[x4 - 1];
            if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
                pallene_runtime_tag_check_error(L,
                    44, LUA_VNUMFLT, rawtt(slot),
                    "array element");
            }
            x6 = fltvalue(slot);
        }
        x5 = (x6 >= x2);
        if (x5) {
            return x4;
        }
    }
    PALLENE_INT_FOR_LOOP_END
    return 1;
}

/* random_fasta benchmarks/fasta//pallene.pln:51 */
static void function_06(
    lua_State *L,
    Udata *G,
    StackValue *base,
    TString *x1, /* id */
    TString *x2, /* desc */
    Table *x3, /* frequencies */
    lua_Integer x4  /* n */
) {
    luaD_checkstack(L, 2);
    ptrdiff_t base_offset = savestack(L, base);
    	
    lua_Integer x5; /* nitems */
    Table *x6; /* letters */
    Table *x7; /* probs */
    lua_Number x8; /* total */
    lua_Integer x9; /* i */
    Table *x10; /* o */
    TString *x11; /* c */
    TValue x12 = {{0},0};
    lua_Number x13; /* p */
    TValue x14 = {{0},0};
    lua_Integer x15; /* col */
    lua_Integer x16; /* _ */
    lua_Integer x17; /* ix */
    lua_Number x18;
    TString *x19; /* c */
    int x20;
    lua_Integer x21;
    int x22;
    	
    function_03(L, G, base + 0, x1, x2);
    base = restorestack(L, base_offset);
    if (x3->metatable) {
        pallene_runtime_array_metatable_error(L, 55);
    }
    x5 = luaH_getn(x3);
    x6 = pallene_createtable(L, 0, 0);
    sethvalue(L, s2v(base + 0), x6);
    luaC_condGC(L, L->top = base + 1, (void)0);
    x7 = pallene_createtable(L, 0, 0);
    sethvalue(L, s2v(base + 1), x7);
    luaC_condGC(L, L->top = base + 2, (void)0);
    x8 = 0.0;
    PALLENE_INT_FOR_LOOP_BEGIN(x9, 1, x5, 1)
    {
        {
            pallene_renormalize_array(L, x3, x9, 61);
            TValue *slot = &x3->array[x9 - 1];
            if (PALLENE_UNLIKELY(!ttistable(slot))) {
                pallene_runtime_tag_check_error(L,
                    61, LUA_TTABLE, rawtt(slot),
                    "array element");
            }
            x10 = hvalue(slot);
        }
        {
            pallene_renormalize_array(L, x10, 1, 62);
            TValue *slot = &x10->array[1 - 1];
            x12 = *(slot);
            if (isempty(slot)) {
                if (x10->metatable) {
                    pallene_runtime_array_metatable_error(L, 62);
                }
            }
            if (isempty(slot)) {
                setnilvalue(&x12);
            }
        }
        if (PALLENE_UNLIKELY(!ttisstring(&x12))) {
            pallene_runtime_tag_check_error(L,
                62, LUA_TSTRING, rawtt(&x12),
                "downcasted value");
        }
        x11 = tsvalue(&x12);
        {
            pallene_renormalize_array(L, x10, 2, 63);
            TValue *slot = &x10->array[2 - 1];
            x14 = *(slot);
            if (isempty(slot)) {
                if (x10->metatable) {
                    pallene_runtime_array_metatable_error(L, 63);
                }
            }
            if (isempty(slot)) {
                setnilvalue(&x14);
            }
        }
        if (PALLENE_UNLIKELY(!ttisfloat(&x14))) {
            pallene_runtime_tag_check_error(L,
                63, LUA_VNUMFLT, rawtt(&x14),
                "downcasted value");
        }
        x13 = fltvalue(&x14);
        x8 = x8 + x13;
        {
            pallene_renormalize_array(L, x6, x9, 65);
            TValue *slot = &x6->array[x9 - 1];
            setsvalue(L, slot, x11);
            pallene_barrierback_unboxed(L, obj2gco(x6), obj2gco(x11));
        }
        {
            pallene_renormalize_array(L, x7, x9, 66);
            TValue *slot = &x7->array[x9 - 1];
            setfltvalue(slot, x8);
        }
    }
    PALLENE_INT_FOR_LOOP_END
    {
        pallene_renormalize_array(L, x7, x5, 68);
        TValue *slot = &x7->array[x5 - 1];
        setfltvalue(slot, 1.0);
    }
    x15 = 0;
    PALLENE_INT_FOR_LOOP_BEGIN(x16, 1, x4, 1)
    {
        x18 = function_02(L, G, base + 2, 1.0);
        base = restorestack(L, base_offset);
        x17 = function_05(L, G, base + 2, x7, x18);
        base = restorestack(L, base_offset);
        {
            pallene_renormalize_array(L, x6, x17, 75);
            TValue *slot = &x6->array[x17 - 1];
            if (PALLENE_UNLIKELY(!ttisstring(slot))) {
                pallene_runtime_tag_check_error(L,
                    75, LUA_TSTRING, rawtt(slot),
                    "array element");
            }
            x19 = tsvalue(slot);
        }
        pallene_io_write(L, x19);
        x15 = intop(+, x15, 1);
        x21 = 60;
        x20 = (x15 >= x21);
        if (x20) {
            pallene_io_write(L, tsvalue(&G->uv[2].uv));
            x15 = 0;
        }
    }
    PALLENE_INT_FOR_LOOP_END
    x22 = (x15 > 0);
    if (x22) {
        pallene_io_write(L, tsvalue(&G->uv[2].uv));
    }
}

/* ------- */
/* Exports */
/* ------- */

static int function_01_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 0)) {
        pallene_runtime_arity_error(L, "$init", 0, nargs);
    }
    	
    function_01(L, G, L->top);
    return 0;
}

static int function_04_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 4)) {
        pallene_runtime_arity_error(L, "repeat_fasta", 4, nargs);
    }
    	
    TString *x1;
    TString *x2;
    TString *x3;
    lua_Integer x4;
    	
    if (PALLENE_UNLIKELY(!ttisstring(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            17, LUA_TSTRING, rawtt(s2v(base + 1)),
            "argument '%s'", "id");
    }
    x1 = tsvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttisstring(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            17, LUA_TSTRING, rawtt(s2v(base + 2)),
            "argument '%s'", "desc");
    }
    x2 = tsvalue(s2v(base + 2));
    	
    if (PALLENE_UNLIKELY(!ttisstring(s2v(base + 3)))) {
        pallene_runtime_tag_check_error(L,
            17, LUA_TSTRING, rawtt(s2v(base + 3)),
            "argument '%s'", "alu");
    }
    x3 = tsvalue(s2v(base + 3));
    	
    if (PALLENE_UNLIKELY(!ttisinteger(s2v(base + 4)))) {
        pallene_runtime_tag_check_error(L,
            17, LUA_VNUMINT, rawtt(s2v(base + 4)),
            "argument '%s'", "n");
    }
    x4 = ivalue(s2v(base + 4));
    	
    function_04(L, G, L->top, x1, x2, x3, x4);
    return 0;
}

static int function_06_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 4)) {
        pallene_runtime_arity_error(L, "random_fasta", 4, nargs);
    }
    	
    TString *x1;
    TString *x2;
    Table *x3;
    lua_Integer x4;
    	
    if (PALLENE_UNLIKELY(!ttisstring(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            51, LUA_TSTRING, rawtt(s2v(base + 1)),
            "argument '%s'", "id");
    }
    x1 = tsvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttisstring(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            51, LUA_TSTRING, rawtt(s2v(base + 2)),
            "argument '%s'", "desc");
    }
    x2 = tsvalue(s2v(base + 2));
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 3)))) {
        pallene_runtime_tag_check_error(L,
            51, LUA_TTABLE, rawtt(s2v(base + 3)),
            "argument '%s'", "frequencies");
    }
    x3 = hvalue(s2v(base + 3));
    	
    if (PALLENE_UNLIKELY(!ttisinteger(s2v(base + 4)))) {
        pallene_runtime_tag_check_error(L,
            51, LUA_VNUMINT, rawtt(s2v(base + 4)),
            "argument '%s'", "n");
    }
    x4 = ivalue(s2v(base + 4));
    	
    function_06(L, G, L->top, x1, x2, x3, x4);
    return 0;
}

int luaopen_benchmarks_fasta__pallene_mod(lua_State *L)
{
    luaL_checkversion(L);
    	
    /* Constants */
    	
    lua_newuserdatauv(L, 0, 6);
    int globals = lua_gettop(L);
    	
    lua_pushstring(L, ">");
    lua_setiuservalue(L, globals, 1);
    	
    lua_pushstring(L, " ");
    lua_setiuservalue(L, globals, 2);
    	
    lua_pushstring(L, "\n");
    lua_setiuservalue(L, globals, 3);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_04_lua, 1);
    lua_setiuservalue(L, globals, 4);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_06_lua, 1);
    lua_setiuservalue(L, globals, 5);
    	
    /* Variables & Initializers */
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_01_lua, 1);
    lua_call(L, 0, 0);
    	
    /* Exports */
    	
    lua_newtable(L);
    int export_table = lua_gettop(L);
    	
    lua_pushstring(L, "repeat_fasta");
    lua_getiuservalue(L, globals, 4);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "random_fasta");
    lua_getiuservalue(L, globals, 5);
    lua_settable(L, export_table);
    	
    lua_pushvalue(L, export_table);
    return 1;
}

