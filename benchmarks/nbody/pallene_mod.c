/* This file was generated by the Pallene compiler. Do not edit by hand" */
/* Indentation and formatting courtesy of pallene/C.lua */

#include "pallene_core.h"

/* ------- */
/* Records */
/* ------- */

/* Body */

typedef struct {
    lua_Number f01; /* x */
    lua_Number f02; /* y */
    lua_Number f03; /* z */
    lua_Number f04; /* vx */
    lua_Number f05; /* vy */
    lua_Number f06; /* vz */
    lua_Number f07; /* mass */
} crecord_01;

inline
static crecord_01 *crecord_01_prims(Udata *u)
{
    char *p = cast_charp(u) + udatamemoffset(0);
    return (crecord_01 *) p;
}

static Udata *crecord_01_new(lua_State *L, Udata *G)
{
    Udata *rec = luaS_newudata(L, sizeof(crecord_01), 0);
    rec->metatable = hvalue(&G->uv[0].uv);
    return rec;
}

/* ------------------- */
/* Function Prototypes */
/* ------------------- */

static void function_01(
    lua_State *L,
    Udata *G,
    StackValue *base
);
static Udata * function_02(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Number x1, /* x */
    lua_Number x2, /* y */
    lua_Number x3, /* z */
    lua_Number x4, /* vx */
    lua_Number x5, /* vy */
    lua_Number x6, /* vz */
    lua_Number x7  /* mass */
);
static void function_03(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* bodies */
);
static void function_04(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* bodies */
    lua_Number x2  /* dt */
);
static void function_05(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Integer x1, /* nsteps */
    Table *x2, /* bodies */
    lua_Number x3  /* dt */
);
static lua_Number function_06(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* bodies */
);

/* ------------------------ */
/* Function Implementations */
/* ------------------------ */

/* $init */
static void function_01(
    lua_State *L,
    Udata *G,
    StackValue *base
) {
    	
}

/* new_body benchmarks/nbody/pallene.pln:11 */
static Udata * function_02(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Number x1, /* x */
    lua_Number x2, /* y */
    lua_Number x3, /* z */
    lua_Number x4, /* vx */
    lua_Number x5, /* vy */
    lua_Number x6, /* vz */
    lua_Number x7  /* mass */
) {
    luaD_checkstack(L, 1);
    Udata *x8;
    	
    x8 = crecord_01_new(L, G);
    setuvalue(L, s2v(base + 0), x8);
    luaC_condGC(L, L->top = base + 1, (void)0);
    crecord_01_prims(x8)->f01 = x1;
    crecord_01_prims(x8)->f02 = x2;
    crecord_01_prims(x8)->f03 = x3;
    crecord_01_prims(x8)->f04 = x4;
    crecord_01_prims(x8)->f05 = x5;
    crecord_01_prims(x8)->f06 = x6;
    crecord_01_prims(x8)->f07 = x7;
    return x8;
}

/* offset_momentum benchmarks/nbody/pallene.pln:26 */
static void function_03(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* bodies */
) {
    lua_Integer x2; /* n */
    lua_Number x3; /* px */
    lua_Number x4; /* py */
    lua_Number x5; /* pz */
    lua_Integer x6; /* i */
    Udata *x7; /* bi */
    lua_Number x8; /* bim */
    Udata *x9; /* sun */
    lua_Number x10; /* solar_mass */
    lua_Number x11;
    lua_Number x12;
    lua_Number x13;
    lua_Number x14;
    lua_Number x15;
    lua_Number x16;
    lua_Number x17;
    lua_Number x18;
    lua_Number x19;
    lua_Number x20;
    lua_Number x21;
    lua_Number x22;
    lua_Number x23;
    lua_Number x24;
    lua_Number x25;
    	
    if (x1->metatable) {
        pallene_runtime_array_metatable_error(L, 27);
    }
    x2 = luaH_getn(x1);
    x3 = 0.0;
    x4 = 0.0;
    x5 = 0.0;
    // for hoist
    pallene_renormalize_array(L, x1, x2, 32);
    PALLENE_INT_FOR_LOOP_BEGIN(x6, 1, x2, 1)
    {
        {
            
            TValue *slot = &x1->array[x6 - 1];
            if (PALLENE_UNLIKELY(!(ttisfulluserdata(slot) && uvalue(slot)->metatable == hvalue(&G->uv[0].uv)))) {
                pallene_runtime_tag_check_error(L,
                    32, LUA_TUSERDATA, rawtt(slot),
                    "array element");
            }
            x7 = uvalue(slot);
        }
        x8 = crecord_01_prims(x7)->f07;
        x12 = crecord_01_prims(x7)->f04;
        x11 = x12 * x8;
        x3 = x3 + x11;
        x14 = crecord_01_prims(x7)->f05;
        x13 = x14 * x8;
        x4 = x4 + x13;
        x16 = crecord_01_prims(x7)->f06;
        x15 = x16 * x8;
        x5 = x5 + x15;
    }
    PALLENE_INT_FOR_LOOP_END
    {
        pallene_renormalize_array(L, x1, 1, 39);
        TValue *slot = &x1->array[1 - 1];
        if (PALLENE_UNLIKELY(!(ttisfulluserdata(slot) && uvalue(slot)->metatable == hvalue(&G->uv[0].uv)))) {
            pallene_runtime_tag_check_error(L,
                39, LUA_TUSERDATA, rawtt(slot),
                "array element");
        }
        x9 = uvalue(slot);
    }
    x10 = crecord_01_prims(x9)->f07;
    x18 = crecord_01_prims(x9)->f04;
    x19 = x3 / x10;
    x17 = x18 - x19;
    crecord_01_prims(x9)->f04 = x17;
    x21 = crecord_01_prims(x9)->f05;
    x22 = x4 / x10;
    x20 = x21 - x22;
    crecord_01_prims(x9)->f05 = x20;
    x24 = crecord_01_prims(x9)->f06;
    x25 = x5 / x10;
    x23 = x24 - x25;
    crecord_01_prims(x9)->f06 = x23;
}

/* advance benchmarks/nbody/pallene.pln:46 */
static void function_04(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* bodies */
    lua_Number x2  /* dt */
) {
    lua_Integer x3; /* n */
    lua_Integer x4; /* i */
    Udata *x5; /* bi */
    lua_Integer x6; /* j */
    Udata *x7; /* bj */
    lua_Number x8; /* dx */
    lua_Number x9; /* dy */
    lua_Number x10; /* dz */
    lua_Number x11; /* dist */
    lua_Number x12; /* mag */
    lua_Number x13; /* bjm */
    lua_Number x14; /* bim */
    lua_Integer x15; /* i */
    Udata *x16; /* bi */
    lua_Integer x17;
    lua_Number x18;
    lua_Number x19;
    lua_Number x20;
    lua_Number x21;
    lua_Number x22;
    lua_Number x23;
    lua_Number x24;
    lua_Number x25;
    lua_Number x26;
    lua_Number x27;
    lua_Number x28;
    lua_Number x29;
    lua_Number x30;
    lua_Number x31;
    lua_Number x32;
    lua_Number x33;
    lua_Number x34;
    lua_Number x35;
    lua_Number x36;
    lua_Number x37;
    lua_Number x38;
    lua_Number x39;
    lua_Number x40;
    lua_Number x41;
    lua_Number x42;
    lua_Number x43;
    lua_Number x44;
    lua_Number x45;
    lua_Number x46;
    lua_Number x47;
    lua_Number x48;
    lua_Number x49;
    lua_Number x50;
    lua_Number x51;
    lua_Number x52;
    lua_Number x53;
    lua_Number x54;
    lua_Number x55;
    lua_Number x56;
    lua_Number x57;
    lua_Number x58;
    lua_Number x59;
    lua_Number x60;
    lua_Number x61;
    lua_Number x62;
    	
    if (x1->metatable) {
        pallene_runtime_array_metatable_error(L, 47);
    }
    x3 = luaH_getn(x1);
    // for hoist
    pallene_renormalize_array(L, x1, x3, 49);
    //const hoist
    // by range analysis x6 < x3 (j < n)
    //pallene_renormalize_array(L, x1, x6, 51);
    // const hoist
    // by range analysis x15 < x3 (i < n)
    //pallene_renormalize_array(L, x1, x15, 71);
    PALLENE_INT_FOR_LOOP_BEGIN(x4, 1, x3, 1)
    {
        {
            
            TValue *slot = &x1->array[x4 - 1];
            if (PALLENE_UNLIKELY(!(ttisfulluserdata(slot) && uvalue(slot)->metatable == hvalue(&G->uv[0].uv)))) {
                pallene_runtime_tag_check_error(L,
                    49, LUA_TUSERDATA, rawtt(slot),
                    "array element");
            }
            x5 = uvalue(slot);
        }
        x17 = intop(+, x4, 1);
        PALLENE_INT_FOR_LOOP_BEGIN(x6, x17, x3, 1)
        {
            {
                
                TValue *slot = &x1->array[x6 - 1];
                if (PALLENE_UNLIKELY(!(ttisfulluserdata(slot) && uvalue(slot)->metatable == hvalue(&G->uv[0].uv)))) {
                    pallene_runtime_tag_check_error(L,
                        51, LUA_TUSERDATA, rawtt(slot),
                        "array element");
                }
                x7 = uvalue(slot);
            }
            x18 = crecord_01_prims(x5)->f01;
            x19 = crecord_01_prims(x7)->f01;
            x8 = x18 - x19;
            x20 = crecord_01_prims(x5)->f02;
            x21 = crecord_01_prims(x7)->f02;
            x9 = x20 - x21;
            x22 = crecord_01_prims(x5)->f03;
            x23 = crecord_01_prims(x7)->f03;
            x10 = x22 - x23;
            x26 = x8 * x8;
            x27 = x9 * x9;
            x25 = x26 + x27;
            x28 = x10 * x10;
            x24 = x25 + x28;
            x11 = sqrt(x24);
            x30 = x11 * x11;
            x29 = x30 * x11;
            x12 = x2 / x29;
            x31 = crecord_01_prims(x7)->f07;
            x13 = x31 * x12;
            x33 = crecord_01_prims(x5)->f04;
            x34 = x8 * x13;
            x32 = x33 - x34;
            crecord_01_prims(x5)->f04 = x32;
            x36 = crecord_01_prims(x5)->f05;
            x37 = x9 * x13;
            x35 = x36 - x37;
            crecord_01_prims(x5)->f05 = x35;
            x39 = crecord_01_prims(x5)->f06;
            x40 = x10 * x13;
            x38 = x39 - x40;
            crecord_01_prims(x5)->f06 = x38;
            x41 = crecord_01_prims(x5)->f07;
            x14 = x41 * x12;
            x43 = crecord_01_prims(x7)->f04;
            x44 = x8 * x14;
            x42 = x43 + x44;
            crecord_01_prims(x7)->f04 = x42;
            x46 = crecord_01_prims(x7)->f05;
            x47 = x9 * x14;
            x45 = x46 + x47;
            crecord_01_prims(x7)->f05 = x45;
            x49 = crecord_01_prims(x7)->f06;
            x50 = x10 * x14;
            x48 = x49 + x50;
            crecord_01_prims(x7)->f06 = x48;
        }
        PALLENE_INT_FOR_LOOP_END
    }
    PALLENE_INT_FOR_LOOP_END
    PALLENE_INT_FOR_LOOP_BEGIN(x15, 1, x3, 1)
    {
        {
            
            TValue *slot = &x1->array[x15 - 1];
            if (PALLENE_UNLIKELY(!(ttisfulluserdata(slot) && uvalue(slot)->metatable == hvalue(&G->uv[0].uv)))) {
                pallene_runtime_tag_check_error(L,
                    71, LUA_TUSERDATA, rawtt(slot),
                    "array element");
            }
            x16 = uvalue(slot);
        }
        x52 = crecord_01_prims(x16)->f01;
        x54 = crecord_01_prims(x16)->f04;
        x53 = x2 * x54;
        x51 = x52 + x53;
        crecord_01_prims(x16)->f01 = x51;
        x56 = crecord_01_prims(x16)->f02;
        x58 = crecord_01_prims(x16)->f05;
        x57 = x2 * x58;
        x55 = x56 + x57;
        crecord_01_prims(x16)->f02 = x55;
        x60 = crecord_01_prims(x16)->f03;
        x62 = crecord_01_prims(x16)->f06;
        x61 = x2 * x62;
        x59 = x60 + x61;
        crecord_01_prims(x16)->f03 = x59;
    }
    PALLENE_INT_FOR_LOOP_END
}

/* advance_multiple_steps benchmarks/nbody/pallene.pln:78 */
static void function_05(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Integer x1, /* nsteps */
    Table *x2, /* bodies */
    lua_Number x3  /* dt */
) {
    lua_Integer x4; /* _ */
    	
    PALLENE_INT_FOR_LOOP_BEGIN(x4, 1, x1, 1)
    {
        {
            StackValue *old_stack = L->stack;
            function_04(L, G, base + 0, x2, x3);
            base = L->stack + (base - old_stack);
        }
    }
    PALLENE_INT_FOR_LOOP_END
}

/* energy benchmarks/nbody/pallene.pln:84 */
static lua_Number function_06(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1  /* bodies */
) {
    lua_Integer x2; /* n */
    lua_Number x3; /* e */
    lua_Integer x4; /* i */
    Udata *x5; /* bi */
    lua_Number x6; /* vx */
    lua_Number x7; /* vy */
    lua_Number x8; /* vz */
    lua_Integer x9; /* j */
    Udata *x10; /* bj */
    lua_Number x11; /* dx */
    lua_Number x12; /* dy */
    lua_Number x13; /* dz */
    lua_Number x14; /* distance */
    lua_Number x15;
    lua_Number x16;
    lua_Number x17;
    lua_Number x18;
    lua_Number x19;
    lua_Number x20;
    lua_Number x21;
    lua_Number x22;
    lua_Integer x23;
    lua_Number x24;
    lua_Number x25;
    lua_Number x26;
    lua_Number x27;
    lua_Number x28;
    lua_Number x29;
    lua_Number x30;
    lua_Number x31;
    lua_Number x32;
    lua_Number x33;
    lua_Number x34;
    lua_Number x35;
    lua_Number x36;
    lua_Number x37;
    lua_Number x38;
    	
    if (x1->metatable) {
        pallene_runtime_array_metatable_error(L, 85);
    }
    x2 = luaH_getn(x1);
    x3 = 0.0;
    PALLENE_INT_FOR_LOOP_BEGIN(x4, 1, x2, 1)
    {
        {
            pallene_renormalize_array(L, x1, x4, 88);
            TValue *slot = &x1->array[x4 - 1];
            if (PALLENE_UNLIKELY(!(ttisfulluserdata(slot) && uvalue(slot)->metatable == hvalue(&G->uv[0].uv)))) {
                pallene_runtime_tag_check_error(L,
                    88, LUA_TUSERDATA, rawtt(slot),
                    "array element");
            }
            x5 = uvalue(slot);
        }
        x6 = crecord_01_prims(x5)->f04;
        x7 = crecord_01_prims(x5)->f05;
        x8 = crecord_01_prims(x5)->f06;
        x17 = crecord_01_prims(x5)->f07;
        x16 = 0.5 * x17;
        x20 = x6 * x6;
        x21 = x7 * x7;
        x19 = x20 + x21;
        x22 = x8 * x8;
        x18 = x19 + x22;
        x15 = x16 * x18;
        x3 = x3 + x15;
        x23 = intop(+, x4, 1);
        // for hoist
        pallene_renormalize_array(L, x1, x2, 94);
        PALLENE_INT_FOR_LOOP_BEGIN(x9, x23, x2, 1)
        {
            {
                
                TValue *slot = &x1->array[x9 - 1];
                if (PALLENE_UNLIKELY(!(ttisfulluserdata(slot) && uvalue(slot)->metatable == hvalue(&G->uv[0].uv)))) {
                    pallene_runtime_tag_check_error(L,
                        94, LUA_TUSERDATA, rawtt(slot),
                        "array element");
                }
                x10 = uvalue(slot);
            }
            x24 = crecord_01_prims(x5)->f01;
            x25 = crecord_01_prims(x10)->f01;
            x11 = x24 - x25;
            x26 = crecord_01_prims(x5)->f02;
            x27 = crecord_01_prims(x10)->f02;
            x12 = x26 - x27;
            x28 = crecord_01_prims(x5)->f03;
            x29 = crecord_01_prims(x10)->f03;
            x13 = x28 - x29;
            x32 = x11 * x11;
            x33 = x12 * x12;
            x31 = x32 + x33;
            x34 = x13 * x13;
            x30 = x31 + x34;
            x14 = sqrt(x30);
            x37 = crecord_01_prims(x5)->f07;
            x38 = crecord_01_prims(x10)->f07;
            x36 = x37 * x38;
            x35 = x36 / x14;
            x3 = x3 - x35;
        }
        PALLENE_INT_FOR_LOOP_END
    }
    PALLENE_INT_FOR_LOOP_END
    return x3;
}

/* ------- */
/* Exports */
/* ------- */

static int function_01_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 0)) {
        pallene_runtime_arity_error(L, "$init", 0, nargs);
    }
    	
    function_01(L, G, L->top);
    return 0;
}

static int function_02_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 7)) {
        pallene_runtime_arity_error(L, "new_body", 7, nargs);
    }
    	
    lua_Number x1;
    lua_Number x2;
    lua_Number x3;
    lua_Number x4;
    lua_Number x5;
    lua_Number x6;
    lua_Number x7;
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            11, LUA_TNUMFLT, rawtt(s2v(base + 1)),
            "argument '%s'", "x");
    }
    x1 = fltvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            11, LUA_TNUMFLT, rawtt(s2v(base + 2)),
            "argument '%s'", "y");
    }
    x2 = fltvalue(s2v(base + 2));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 3)))) {
        pallene_runtime_tag_check_error(L,
            11, LUA_TNUMFLT, rawtt(s2v(base + 3)),
            "argument '%s'", "z");
    }
    x3 = fltvalue(s2v(base + 3));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 4)))) {
        pallene_runtime_tag_check_error(L,
            11, LUA_TNUMFLT, rawtt(s2v(base + 4)),
            "argument '%s'", "vx");
    }
    x4 = fltvalue(s2v(base + 4));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 5)))) {
        pallene_runtime_tag_check_error(L,
            11, LUA_TNUMFLT, rawtt(s2v(base + 5)),
            "argument '%s'", "vy");
    }
    x5 = fltvalue(s2v(base + 5));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 6)))) {
        pallene_runtime_tag_check_error(L,
            11, LUA_TNUMFLT, rawtt(s2v(base + 6)),
            "argument '%s'", "vz");
    }
    x6 = fltvalue(s2v(base + 6));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 7)))) {
        pallene_runtime_tag_check_error(L,
            11, LUA_TNUMFLT, rawtt(s2v(base + 7)),
            "argument '%s'", "mass");
    }
    x7 = fltvalue(s2v(base + 7));
    	
    Udata *ret1;
    ret1 = function_02(L, G, L->top, x1, x2, x3, x4, x5, x6, x7);
    setuvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

static int function_03_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 1)) {
        pallene_runtime_arity_error(L, "offset_momentum", 1, nargs);
    }
    	
    Table *x1;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            26, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "bodies");
    }
    x1 = hvalue(s2v(base + 1));
    	
    function_03(L, G, L->top, x1);
    return 0;
}

static int function_04_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 2)) {
        pallene_runtime_arity_error(L, "advance", 2, nargs);
    }
    	
    Table *x1;
    lua_Number x2;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            46, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "bodies");
    }
    x1 = hvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            46, LUA_TNUMFLT, rawtt(s2v(base + 2)),
            "argument '%s'", "dt");
    }
    x2 = fltvalue(s2v(base + 2));
    	
    function_04(L, G, L->top, x1, x2);
    return 0;
}

static int function_05_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 3)) {
        pallene_runtime_arity_error(L, "advance_multiple_steps", 3, nargs);
    }
    	
    lua_Integer x1;
    Table *x2;
    lua_Number x3;
    	
    if (PALLENE_UNLIKELY(!ttisinteger(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            78, LUA_TNUMINT, rawtt(s2v(base + 1)),
            "argument '%s'", "nsteps");
    }
    x1 = ivalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            78, LUA_TTABLE, rawtt(s2v(base + 2)),
            "argument '%s'", "bodies");
    }
    x2 = hvalue(s2v(base + 2));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 3)))) {
        pallene_runtime_tag_check_error(L,
            78, LUA_TNUMFLT, rawtt(s2v(base + 3)),
            "argument '%s'", "dt");
    }
    x3 = fltvalue(s2v(base + 3));
    	
    function_05(L, G, L->top, x1, x2, x3);
    return 0;
}

static int function_06_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 1)) {
        pallene_runtime_arity_error(L, "energy", 1, nargs);
    }
    	
    Table *x1;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            84, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "bodies");
    }
    x1 = hvalue(s2v(base + 1));
    	
    lua_Number ret1;
    ret1 = function_06(L, G, L->top, x1);
    setfltvalue(s2v(L->top), ret1);
    L->top++;
    return 1;
}

int luaopen_benchmarks_nbody_pallene_mod(lua_State *L)
{
    luaL_checkversion(L);
    	
    lua_newuserdatauv(L, 0, 1);
    int globals = lua_gettop(L);
    	
    lua_createtable(L, 6, 0);
    int closures = lua_gettop(L);
    	
    lua_newtable(L);
    int export_table = lua_gettop(L);
    	
    /* Closures */
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_01_lua, 1);
    lua_seti(L, closures, 1);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_02_lua, 1);
    lua_seti(L, closures, 2);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_03_lua, 1);
    lua_seti(L, closures, 3);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_04_lua, 1);
    lua_seti(L, closures, 4);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_05_lua, 1);
    lua_seti(L, closures, 5);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_06_lua, 1);
    lua_seti(L, closures, 6);
    	
    /* Global values */
    	
    lua_newtable(L);
    lua_pushstring(L, "__metatable");
    lua_pushboolean(L, 0);
    lua_settable(L, -3);
    lua_setiuservalue(L, globals, 1);
    	
    // Run toplevel statements & initialize globals
    lua_geti(L, closures, 1);
    lua_call(L, 0, 0);
    	
    /* Exports */
    	
    lua_pushstring(L, "new_body");
    lua_geti(L, closures, 2);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "offset_momentum");
    lua_geti(L, closures, 3);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "advance");
    lua_geti(L, closures, 4);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "advance_multiple_steps");
    lua_geti(L, closures, 5);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "energy");
    lua_geti(L, closures, 6);
    lua_settable(L, export_table);
    	
    lua_pushvalue(L, export_table);
    return 1;
}

