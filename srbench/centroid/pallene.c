/* This file was generated by the Pallene compiler. Do not edit by hand" */
/* Indentation and formatting courtesy of pallene/C.lua */

#include "pallene_core.h"

/* ------- */
/* Records */
/* ------- */

/* ------------------- */
/* Function Prototypes */
/* ------------------- */

static void function_01(
    lua_State *L,
    Udata *G,
    StackValue *base
);
static Table * function_02(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Number x1, /* x */
    lua_Number x2  /* y */
);
static Table * function_03(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* points */
    lua_Integer x2  /* nrep */
);
static Table * function_04(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Integer x1, /* N */
    lua_Integer x2  /* nrep */
);

/* ------------------------ */
/* Function Implementations */
/* ------------------------ */

/* $init */
static void function_01(
    lua_State *L,
    Udata *G,
    StackValue *base
) {
    ptrdiff_t base_offset = savestack(L, base);
    	
}

/* new srbench/centroid/pallene.pln:1 */
static Table * function_02(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Number x1, /* x */
    lua_Number x2  /* y */
) {
    luaD_checkstack(L, 1);
    ptrdiff_t base_offset = savestack(L, base);
    	
    Table *x3;
    	
    x3 = pallene_createtable(L, 2, 0);
    sethvalue(L, s2v(base + 0), x3);
    luaC_condGC(L, L->top = base + 1, (void)0);
    {
        pallene_renormalize_array(L, x3, 1, 2);
        TValue *slot = &x3->array[1 - 1];
        setfltvalue(slot, x1);
    }
    {
        pallene_renormalize_array(L, x3, 2, 2);
        TValue *slot = &x3->array[2 - 1];
        setfltvalue(slot, x2);
    }
    return x3;
}

/* centroid srbench/centroid/pallene.pln:5 */
static Table * function_03(
    lua_State *L,
    Udata *G,
    StackValue *base,
    Table *x1, /* points */
    lua_Integer x2  /* nrep */
) {
    luaD_checkstack(L, 1);
    ptrdiff_t base_offset = savestack(L, base);
    	
    lua_Number x3; /* x */
    lua_Number x4; /* y */
    lua_Integer x5; /* npoints */
    lua_Integer x6; /* _ */
    lua_Integer x7; /* i */
    Table *x8; /* p */
    lua_Number x9;
    lua_Number x10;
    Table *x11;
    lua_Number x12;
    lua_Number x13;
    lua_Number x14;
    lua_Number x15;
    	
    x3 = 0.0;
    x4 = 0.0;
    if (x1->metatable) {
        pallene_runtime_array_metatable_error(L, 8);
    }
    x5 = luaH_getn(x1);
    PALLENE_INT_FOR_LOOP_BEGIN(x6, 1, x2, 1)
    {
        x3 = 0.0;
        x4 = 0.0;
        PALLENE_INT_FOR_LOOP_BEGIN(x7, 1, x5, 1)
        {
            {
                pallene_renormalize_array(L, x1, x7, 13);
                TValue *slot = &x1->array[x7 - 1];
                if (PALLENE_UNLIKELY(!ttistable(slot))) {
                    pallene_runtime_tag_check_error(L,
                        13, LUA_TTABLE, rawtt(slot),
                        "array element");
                }
                x8 = hvalue(slot);
            }
            {
                pallene_renormalize_array(L, x8, 1, 14);
                TValue *slot = &x8->array[1 - 1];
                if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
                    pallene_runtime_tag_check_error(L,
                        14, LUA_VNUMFLT, rawtt(slot),
                        "array element");
                }
                x9 = fltvalue(slot);
            }
            x3 = x3 + x9;
            {
                pallene_renormalize_array(L, x8, 2, 15);
                TValue *slot = &x8->array[2 - 1];
                if (PALLENE_UNLIKELY(!ttisfloat(slot))) {
                    pallene_runtime_tag_check_error(L,
                        15, LUA_VNUMFLT, rawtt(slot),
                        "array element");
                }
                x10 = fltvalue(slot);
            }
            x4 = x4 + x10;
        }
        PALLENE_INT_FOR_LOOP_END
    }
    PALLENE_INT_FOR_LOOP_END
    x11 = pallene_createtable(L, 2, 0);
    sethvalue(L, s2v(base + 0), x11);
    luaC_condGC(L, L->top = base + 1, (void)0);
    x13 = (lua_Number) x5;
    x12 = x3 / x13;
    {
        pallene_renormalize_array(L, x11, 1, 18);
        TValue *slot = &x11->array[1 - 1];
        setfltvalue(slot, x12);
    }
    x15 = (lua_Number) x5;
    x14 = x4 / x15;
    {
        pallene_renormalize_array(L, x11, 2, 18);
        TValue *slot = &x11->array[2 - 1];
        setfltvalue(slot, x14);
    }
    return x11;
}

/* all srbench/centroid/pallene.pln:21 */
static Table * function_04(
    lua_State *L,
    Udata *G,
    StackValue *base,
    lua_Integer x1, /* N */
    lua_Integer x2  /* nrep */
) {
    luaD_checkstack(L, 1);
    ptrdiff_t base_offset = savestack(L, base);
    	
    Table *x3; /* arr */
    lua_Integer x4; /* i */
    lua_Number x5; /* d */
    lua_Number x6;
    Table *x7;
    Table *x8;
    	
    x3 = pallene_createtable(L, 0, 0);
    sethvalue(L, s2v(base + 0), x3);
    luaC_condGC(L, L->top = base + 1, (void)0);
    PALLENE_INT_FOR_LOOP_BEGIN(x4, 1, x1, 1)
    {
        x6 = (lua_Number) x4;
        x5 = x6 * 3.1415000000000002;
        x7 = function_02(L, G, base + 1, x5, x5);
        base = restorestack(L, base_offset);
        {
            pallene_renormalize_array(L, x3, x4, 25);
            TValue *slot = &x3->array[x4 - 1];
            sethvalue(L, slot, x7);
            pallene_barrierback_unboxed(L, obj2gco(x3), obj2gco(x7));
        }
    }
    PALLENE_INT_FOR_LOOP_END
    x8 = function_03(L, G, base + 1, x3, x2);
    base = restorestack(L, base_offset);
    return x8;
}

/* ------- */
/* Exports */
/* ------- */

static int function_01_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 0)) {
        pallene_runtime_arity_error(L, "$init", 0, nargs);
    }
    	
    function_01(L, G, L->top);
    return 0;
}

static int function_02_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 2)) {
        pallene_runtime_arity_error(L, "new", 2, nargs);
    }
    	
    lua_Number x1;
    lua_Number x2;
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            1, LUA_VNUMFLT, rawtt(s2v(base + 1)),
            "argument '%s'", "x");
    }
    x1 = fltvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttisfloat(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            1, LUA_VNUMFLT, rawtt(s2v(base + 2)),
            "argument '%s'", "y");
    }
    x2 = fltvalue(s2v(base + 2));
    	
    Table *ret1;
    ret1 = function_02(L, G, L->top, x1, x2);
    sethvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

static int function_03_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 2)) {
        pallene_runtime_arity_error(L, "centroid", 2, nargs);
    }
    	
    Table *x1;
    lua_Integer x2;
    	
    if (PALLENE_UNLIKELY(!ttistable(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            5, LUA_TTABLE, rawtt(s2v(base + 1)),
            "argument '%s'", "points");
    }
    x1 = hvalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttisinteger(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            5, LUA_VNUMINT, rawtt(s2v(base + 2)),
            "argument '%s'", "nrep");
    }
    x2 = ivalue(s2v(base + 2));
    	
    Table *ret1;
    ret1 = function_03(L, G, L->top, x1, x2);
    sethvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

static int function_04_lua(lua_State *L)
{
    StackValue *base = L->ci->func;
    CClosure *func = clCvalue(s2v(base));
    Udata *G = uvalue(&func->upvalue[0]);
    	
    int nargs = lua_gettop(L);
    if (PALLENE_UNLIKELY(nargs != 2)) {
        pallene_runtime_arity_error(L, "all", 2, nargs);
    }
    	
    lua_Integer x1;
    lua_Integer x2;
    	
    if (PALLENE_UNLIKELY(!ttisinteger(s2v(base + 1)))) {
        pallene_runtime_tag_check_error(L,
            21, LUA_VNUMINT, rawtt(s2v(base + 1)),
            "argument '%s'", "N");
    }
    x1 = ivalue(s2v(base + 1));
    	
    if (PALLENE_UNLIKELY(!ttisinteger(s2v(base + 2)))) {
        pallene_runtime_tag_check_error(L,
            21, LUA_VNUMINT, rawtt(s2v(base + 2)),
            "argument '%s'", "nrep");
    }
    x2 = ivalue(s2v(base + 2));
    	
    Table *ret1;
    ret1 = function_04(L, G, L->top, x1, x2);
    sethvalue(L, s2v(L->top), ret1);
    L->top++;
    return 1;
}

int luaopen_srbench_centroid_pallene(lua_State *L)
{
    luaL_checkversion(L);
    	
    /* Constants */
    	
    lua_newuserdatauv(L, 0, 3);
    int globals = lua_gettop(L);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_02_lua, 1);
    lua_setiuservalue(L, globals, 1);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_03_lua, 1);
    lua_setiuservalue(L, globals, 2);
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_04_lua, 1);
    lua_setiuservalue(L, globals, 3);
    	
    /* Variables & Initializers */
    	
    lua_pushvalue(L, globals);
    lua_pushcclosure(L, function_01_lua, 1);
    lua_call(L, 0, 0);
    	
    /* Exports */
    	
    lua_newtable(L);
    int export_table = lua_gettop(L);
    	
    lua_pushstring(L, "new");
    lua_getiuservalue(L, globals, 1);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "centroid");
    lua_getiuservalue(L, globals, 2);
    lua_settable(L, export_table);
    	
    lua_pushstring(L, "all");
    lua_getiuservalue(L, globals, 3);
    lua_settable(L, export_table);
    	
    lua_pushvalue(L, export_table);
    return 1;
}

